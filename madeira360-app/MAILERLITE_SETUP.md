# Настройка MailerLite для приложения Madeira360

## Проблема

Если кастомные поля не созданы в MailerLite, API будет их игнорировать. Подписчик будет добавлен только с email, но без дополнительных данных (travel_dates, interests, locale, UTM-параметры).

## Решение: Создание кастомных полей в MailerLite

### Шаг 1: Войдите в аккаунт MailerLite

1. Откройте https://dashboard.mailerlite.com
2. Войдите в свой аккаунт

### Шаг 2: Создайте пользовательские поля

Перейдите: **Подписчики → Пользовательские поля → Добавить поле**

Создайте следующие поля:

#### 1. Поле `travel_date_1`
- **Название**: Travel Date 1 (или "Дата приезда" / "Arrival Date")
- **Ключ (Key)**: `travel_date_1` (важно: именно так, как в коде)
- **Тип**: **Даты** (Date) - рекомендуется, или **Текст** (Text) если тип "Даты" не работает
- **Обязательное**: Нет
- **Описание**: Дата начала отпуска (приезд)

#### 2. Поле `travel_date_2`
- **Название**: Travel Date 2 (или "Дата отъезда" / "Departure Date")
- **Ключ (Key)**: `travel_date_2` (важно: именно так, как в коде)
- **Тип**: **Даты** (Date) - рекомендуется, или **Текст** (Text) если тип "Даты" не работает
- **Обязательное**: Нет
- **Описание**: Дата окончания отпуска (отъезд)

#### 3. Поле `interests`
- **Название**: Interests (или "Интересы")
- **Ключ (Key)**: `interests` (важно: именно так, как в коде)
- **Тип**: **Текст** (Text)
- **Обязательное**: Нет
- **Описание**: Может содержать несколько значений через запятую, например: "Nature & hikes, Beaches & relax, Food & wine"
- **Максимальная длина**: Рекомендуется 1000+ символов (в коде ограничение 1000)

#### 4. Поле `locale`
- **Название**: Locale (или "Язык")
- **Ключ (Key)**: `locale` (важно: именно так, как в коде)
- **Тип**: **Текст** (Text)
- **Обязательное**: Нет
- **Описание**: Языковой код пользователя. Возможные значения: `de` (немецкий) или `en` (английский)
- **Примечание**: В вашем аккаунте MailerLite доступны только типы: Текст, Даты, Число. Используйте Текст для этого поля.

#### 5. UTM-параметры (опционально)

Если хотите отслеживать UTM-метки:

- **Поле `utm_source`**
  - Ключ: `utm_source`
  - Тип: **Текст** (Text)
  
- **Поле `utm_medium`**
  - Ключ: `utm_medium`
  - Тип: **Текст** (Text)
  
- **Поле `utm_campaign`**
  - Ключ: `utm_campaign`
  - Тип: **Текст** (Text)

## Доступные типы полей в вашем аккаунте

В вашем аккаунте MailerLite доступны только 3 типа полей:
1. **Текст** (Text)
2. **Даты** (Date)
3. **Число** (Number)

## Итоговая таблица полей

| Поле | Ключ | Тип в MailerLite | Обязательное | Описание |
|------|------|------------------|--------------|----------|
| `travel_date_1` | `travel_date_1` | **Даты** (Date) или **Текст** (Text) | Нет | Дата приезда (начало отпуска) |
| `travel_date_2` | `travel_date_2` | **Даты** (Date) или **Текст** (Text) | Нет | Дата отъезда (конец отпуска) |
| `interests` | `interests` | **Текст** (Text) | Нет | Интересы через запятую |
| `locale` | `locale` | **Текст** (Text) | Нет | Язык: `de` или `en` |
| `utm_source` | `utm_source` | **Текст** (Text) | Нет | UTM источник |
| `utm_medium` | `utm_medium` | **Текст** (Text) | Нет | UTM канал |
| `utm_campaign` | `utm_campaign` | **Текст** (Text) | Нет | UTM кампания |

### Шаг 3: Создайте группу (опционально)

Если хотите группировать подписчиков:

1. Перейдите: **Подписчики → Группы → Создать группу**
2. Назовите группу (например, "Trip Planning Subscribers")
3. Скопируйте **ID группы** (это число или строка)
4. Добавьте в `.env.local`:
   ```
   MAILERLITE_GROUP_ID=ваш_id_группы
   ```

### Шаг 4: Проверка API токена

1. Перейдите: **Интеграции → API**
2. Создайте новый API токен или используйте существующий
3. Убедитесь, что токен добавлен в `.env.local`:
   ```
   MAILERLITE_API_TOKEN=ваш_токен
   ```

## Важно: Ключи полей

**Ключи полей в MailerLite должны точно совпадать с ключами в коде:**

- `travel_date_1` (не `travelDate1` или `travel_date_1_`)
- `travel_date_2` (не `travelDate2` или `travel_date_2_`)
- `interests` (не `interest` или `user_interests`)
- `locale` (не `language` или `lang`)
- `utm_source`, `utm_medium`, `utm_campaign` (с префиксом `utm_`)

## Проверка работы

После создания полей:

1. Заполните форму на сайте
2. Проверьте в MailerLite: **Подписчики → [найдите email]**
3. Убедитесь, что все поля заполнены

## Отладка

Если данные не передаются:

1. Проверьте логи сервера (в консоли Vercel или локально)
2. Убедитесь, что ключи полей совпадают точно
3. Проверьте, что API токен имеет права на создание/обновление подписчиков
4. Проверьте ответ API в логах (теперь логируется подробная информация об ошибках)

## Документация MailerLite API

- Официальная документация: https://developers.mailerlite.com/docs
- API для подписчиков: https://developers.mailerlite.com/docs/subscribers

